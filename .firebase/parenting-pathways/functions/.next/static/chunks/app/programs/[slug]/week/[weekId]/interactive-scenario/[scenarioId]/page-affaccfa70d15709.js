(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8531],{5845:(e,t,s)=>{"use strict";s.d(t,{i:()=>n});var r=s(12115),a=s(39033);function n({prop:e,defaultProp:t,onChange:s=()=>{}}){let[n,o]=function({defaultProp:e,onChange:t}){let s=r.useState(e),[n]=s,o=r.useRef(n),l=(0,a.c)(t);return r.useEffect(()=>{o.current!==n&&(l(n),o.current=n)},[n,o,l]),s}({defaultProp:t,onChange:s}),l=void 0!==e,i=l?e:n,c=(0,a.c)(s);return[i,r.useCallback(t=>{if(l){let s="function"==typeof t?t(e):t;s!==e&&c(s)}else o(t)},[l,e,o,c])]}},23860:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var r=s(95155),a=s(12115),n=s(30285),o=s(66695),l=s(30356),i=s(85057),c=s(88539),d=s(40157);let u=(0,d.A)("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);var f=s(91721),m=s(73672);let p=(0,d.A)("CornerDownLeft",[["polyline",{points:"9 10 4 15 9 20",key:"r3jprv"}],["path",{d:"M20 4v7a4 4 0 0 1-4 4H4",key:"6o5b7l"}]]);var x=s(66766);function h(e){let{scenario:t,onScenarioComplete:s}=e,[d,h]=(0,a.useState)(t.startNodeId),[g,v]=(0,a.useState)([]),[N,y]=(0,a.useState)({}),[b,j]=(0,a.useState)(""),w=(0,a.useRef)(null),S=t.nodes.find(e=>e.id===d);(0,a.useEffect)(()=>{if(S){let e=g.length>0?g[g.length-1]:null;e&&e.nodeId===S.id||v(e=>[...e,{id:"".concat(Date.now(),"-").concat(S.id),nodeId:S.id,nodeText:S.text,nodeImageUrl:S.imageUrl,nodeCharacter:S.character}])}},[d]),(0,a.useEffect)(()=>{var e;null===(e=w.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[g]);let k=e=>{if(!S)return;let r={...N,[S.id]:e.text};if(y(r),v(t=>t.map(t=>t.nodeId===S.id&&t.id===g[g.length-1].id?{...t,userResponse:e.text}:t)),e.endsScenario){s&&s(t.id,r);return}if(e.feedback){let a="temp-feedback-".concat(Date.now());v(t=>[...t,{id:a,nodeId:a,nodeText:e.feedback,nodeCharacter:"guide"}]),e.nextNodeId?h(e.nextNodeId):s&&s(t.id,r)}else e.nextNodeId?h(e.nextNodeId):s&&s(t.id,r)},I=()=>{if(!S)return;let e={...N};if("message"===S.type){S.nextNodeId?h(S.nextNodeId):"summary"===S.type&&s&&s(t.id,e);return}if("reflection_prompt"===S.type){if(!b.trim()&&!(S.options&&S.options.length>0))return;y(e={...N,[S.id]:b}),v(e=>e.map(e=>e.nodeId===S.id&&e.id===g[g.length-1].id?{...e,userResponse:b}:e)),j(""),S.nextNodeId?h(S.nextNodeId):s&&s(t.id,e)}};if(!S)return(0,r.jsx)(o.Zp,{children:(0,r.jsx)(o.Wu,{className:"p-6",children:(0,r.jsx)("p",{className:"text-muted-foreground",children:"Scenario ended or error loading current step."})})});let _=g.length>0?g[g.length-1]:null,C=(null==_?void 0:_.nodeId)===S.id&&(null==_?void 0:_.userResponse)!==void 0,A=null==_?void 0:_.nodeId.startsWith("temp-feedback-");return(0,r.jsxs)(o.Zp,{className:"w-full max-w-2xl mx-auto shadow-xl flex flex-col",style:{height:"calc(100vh - 200px)"},children:[(0,r.jsx)(o.aR,{className:"bg-primary/10",children:(0,r.jsx)(o.ZB,{className:"text-primary text-xl",children:t.title})}),(0,r.jsxs)(o.Wu,{className:"flex-grow overflow-y-auto p-4 space-y-4 bg-secondary/10",children:[g.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-start space-x-3 mb-2 ".concat("user"===e.nodeCharacter?"justify-end":""),children:["user"!==e.nodeCharacter&&(0,r.jsx)(u,{className:"h-8 w-8 text-primary bg-primary/20 p-1.5 rounded-full shrink-0 mt-1"}),(0,r.jsxs)("div",{className:"p-3 rounded-lg max-w-[85%] text-sm ".concat("user"===e.nodeCharacter?"bg-accent text-accent-foreground self-end":"bg-card text-card-foreground shadow-sm"),children:[(0,r.jsx)("p",{className:"whitespace-pre-wrap",children:e.nodeText}),e.nodeImageUrl&&(0,r.jsx)(x.default,{src:e.nodeImageUrl,alt:"Scenario image",width:200,height:150,className:"mt-2 rounded-md","data-ai-hint":"scenario illustration"})]})]}),e.userResponse&&(0,r.jsxs)("div",{className:"flex items-start space-x-3 justify-end mb-2 mt-2",children:[(0,r.jsxs)("div",{className:"p-3 rounded-lg max-w-[85%] bg-accent text-accent-foreground self-end",children:[(0,r.jsx)("p",{className:"text-xs font-medium text-accent-foreground/80 mb-0.5",children:"Your response:"}),(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:Array.isArray(e.userResponse)?e.userResponse.join(", "):e.userResponse})]}),(0,r.jsx)(f.A,{className:"h-8 w-8 text-accent bg-accent/20 p-1.5 rounded-full shrink-0 mt-1"})]})]},e.id)),(0,r.jsx)("div",{ref:w})]}),(0,r.jsxs)(o.wL,{className:"p-4 border-t bg-card",children:["question_single_choice"===S.type&&S.options&&!C&&!A&&(0,r.jsx)(l.z,{onValueChange:e=>{var t;let s=null===(t=S.options)||void 0===t?void 0:t.find(t=>t.text===e);s&&k(s)},className:"space-y-2 w-full",children:S.options.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(l.C,{value:e.text,id:"".concat(S.id,"-opt-").concat(t)}),(0,r.jsx)(i.J,{htmlFor:"".concat(S.id,"-opt-").concat(t),className:"cursor-pointer hover:text-accent",children:e.text})]},e.id||e.text))}),"reflection_prompt"===S.type&&!C&&!A&&(0,r.jsxs)("div",{className:"w-full flex gap-2",children:[(0,r.jsx)(c.T,{placeholder:"Your thoughts...",value:b,onChange:e=>j(e.target.value),className:"flex-grow",rows:2}),(0,r.jsxs)(n.$,{onClick:I,className:"bg-accent hover:bg-accent/90 text-accent-foreground",disabled:!b.trim()&&!(S.options&&S.options.length>0),children:[(0,r.jsx)(m.A,{className:"h-4 w-4 mr-2"})," Submit"]})]}),"message"===S.type&&S.nextNodeId&&!S.id.startsWith("temp-feedback-")&&(0,r.jsx)("div",{className:"w-full",children:(0,r.jsxs)(n.$,{onClick:I,className:"w-full bg-accent hover:bg-accent/90 text-accent-foreground",children:[(0,r.jsx)(p,{className:"h-4 w-4 mr-2"})," Continue"]})}),A&&S.nextNodeId&&(0,r.jsxs)(n.$,{onClick:()=>h(S.nextNodeId),className:"w-full bg-accent hover:bg-accent/90 text-accent-foreground",children:[(0,r.jsx)(p,{className:"h-4 w-4 mr-2"})," Continue"]}),"summary"===S.type&&(0,r.jsx)(n.$,{onClick:()=>null==s?void 0:s(t.id,N),className:"w-full bg-primary hover:bg-primary/80",children:"Finish Scenario"}),C&&!A&&S.nextNodeId&&("question_single_choice"===S.type||"reflection_prompt"===S.type)&&(0,r.jsxs)(n.$,{onClick:()=>h(S.nextNodeId),className:"w-full bg-accent hover:bg-accent/90 text-accent-foreground",children:[(0,r.jsx)(p,{className:"h-4 w-4 mr-2"})," Continue"]}),C&&!A&&!S.nextNodeId&&("question_single_choice"===S.type||"reflection_prompt"===S.type)&&s&&(0,r.jsx)(n.$,{onClick:()=>s(t.id,N),className:"w-full bg-primary hover:bg-primary/80",children:"Finish Scenario"})]})]})}var g=s(39022),v=s(6874),N=s.n(v),y=s(12543),b=s(35695),j=s(87481);function w(e){let{}=e,{scenarioId:t,slug:s,weekId:o}=(0,b.useParams)(),l=(0,b.useRouter)(),{toast:i}=(0,j.dj)(),[c,d]=(0,a.useState)(null),[u,f]=(0,a.useState)(null),[m,p]=(0,a.useState)(null),[x,v]=(0,a.useState)(void 0),[w,S]=(0,a.useState)(void 0),[k,I]=(0,a.useState)(void 0),[_,C]=(0,a.useState)(null),[A,T]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{"string"==typeof t?d(t):d(null)},[t]),(0,a.useEffect)(()=>{"string"==typeof s?f(s):f(null)},[s]),(0,a.useEffect)(()=>{"string"==typeof o?p(o):p(null)},[o]),(0,a.useEffect)(()=>{let e=localStorage.getItem("userProfile");if(e)try{C(JSON.parse(e))}catch(e){console.error("Failed to parse userProfile from localStorage",e),C(g._o)}else C(g._o)},[]),(0,a.useEffect)(()=>{c&&u&&m?(T(!0),v(g._v.find(e=>e.id===c)||null),(async()=>{let e=g.SR.find(e=>e.slug===u);S(e||null),e?I(e.weeks.find(e=>e.id===m)||null):I(null),T(!1)})()):(null===t||null===s||null===o)&&T(!1)},[c,u,m,t,s,o]),A)?(0,r.jsx)("div",{className:"text-center py-10",children:(0,r.jsx)("p",{children:"Loading scenario details..."})}):x&&w&&k&&_?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)(n.$,{variant:"outline",asChild:!0,children:(0,r.jsxs)(N(),{href:u&&m?"/programs/".concat(u,"/week/").concat(m):u?"/programs/".concat(u):"/programs",children:[(0,r.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Back to Week Content"]})})}),(0,r.jsx)(h,{scenario:x,onScenarioComplete:(e,t)=>{if(console.log("Scenario ".concat(e," completed. Responses:"),t),_){let s={..._,scenarioResponses:{..._.scenarioResponses||{},[e]:t}};localStorage.setItem("userProfile",JSON.stringify(s)),C(s),i({title:"Scenario Responses Saved",description:"Your progress has been recorded."})}u&&m&&l.push("/programs/".concat(u,"/week/").concat(m))}})]}):(0,r.jsxs)("div",{className:"text-center py-10",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"Scenario Not Found or User Data Missing"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"The interactive scenario you are looking for does not exist or user data could not be loaded."}),(0,r.jsx)(n.$,{asChild:!0,variant:"link",className:"mt-4",children:(0,r.jsxs)(N(),{href:u&&m?"/programs/".concat(u,"/week/").concat(m):u?"/programs/".concat(u):"/programs",children:[(0,r.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Back to Program/Week"]})})]})}},30356:(e,t,s)=>{"use strict";s.d(t,{C:()=>c,z:()=>i});var r=s(95155),a=s(12115),n=s(54059),o=s(70154),l=s(59434);let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.bL,{className:(0,l.cn)("grid gap-2",s),...a,ref:t})});i.displayName=n.bL.displayName;let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.q7,{ref:t,className:(0,l.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:(0,r.jsx)(n.C1,{className:"flex items-center justify-center",children:(0,r.jsx)(o.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});c.displayName=n.q7.displayName},35695:(e,t,s)=>{"use strict";var r=s(18999);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},39033:(e,t,s)=>{"use strict";s.d(t,{c:()=>a});var r=s(12115);function a(e){let t=r.useRef(e);return r.useEffect(()=>{t.current=e}),r.useMemo(()=>(...e)=>t.current?.(...e),[])}},40968:(e,t,s)=>{"use strict";s.d(t,{b:()=>l});var r=s(12115),a=s(63655),n=s(95155),o=r.forwardRef((e,t)=>(0,n.jsx)(a.sG.label,{...e,ref:t,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||(null===(s=e.onMouseDown)||void 0===s||s.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));o.displayName="Label";var l=o},46081:(e,t,s)=>{"use strict";s.d(t,{A:()=>o,q:()=>n});var r=s(12115),a=s(95155);function n(e,t){let s=r.createContext(t),n=e=>{let{children:t,...n}=e,o=r.useMemo(()=>n,Object.values(n));return(0,a.jsx)(s.Provider,{value:o,children:t})};return n.displayName=e+"Provider",[n,function(a){let n=r.useContext(s);if(n)return n;if(void 0!==t)return t;throw Error(`\`${a}\` must be used within \`${e}\``)}]}function o(e,t=[]){let s=[],n=()=>{let t=s.map(e=>r.createContext(e));return function(s){let a=s?.[e]||t;return r.useMemo(()=>({[`__scope${e}`]:{...s,[e]:a}}),[s,a])}};return n.scopeName=e,[function(t,n){let o=r.createContext(n),l=s.length;s=[...s,n];let i=t=>{let{scope:s,children:n,...i}=t,c=s?.[e]?.[l]||o,d=r.useMemo(()=>i,Object.values(i));return(0,a.jsx)(c.Provider,{value:d,children:n})};return i.displayName=t+"Provider",[i,function(s,a){let i=a?.[e]?.[l]||o,c=r.useContext(i);if(c)return c;if(void 0!==n)return n;throw Error(`\`${s}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let s=()=>{let s=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let a=s.reduce((t,{useScope:s,scopeName:r})=>{let a=s(e)[`__scope${r}`];return{...t,...a}},{});return r.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return s.scopeName=t.scopeName,s}(n,...t)]}},52712:(e,t,s)=>{"use strict";s.d(t,{N:()=>a});var r=s(12115),a=globalThis?.document?r.useLayoutEffect:()=>{}},61285:(e,t,s)=>{"use strict";s.d(t,{B:()=>i});var r,a=s(12115),n=s(52712),o=(r||(r=s.t(a,2)))["useId".toString()]||(()=>void 0),l=0;function i(e){let[t,s]=a.useState(o());return(0,n.N)(()=>{e||s(e=>e??String(l++))},[e]),e||(t?`radix-${t}`:"")}},63993:(e,t,s)=>{Promise.resolve().then(s.bind(s,23860))},66766:(e,t,s)=>{"use strict";s.d(t,{default:()=>a.a});var r=s(71469),a=s.n(r)},71469:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{default:function(){return i},getImageProps:function(){return l}});let r=s(88229),a=s(38883),n=s(33063),o=r._(s(51193));function l(e){let{props:t}=(0,a.getImgProps)(e,{defaultLoader:o.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,s]of Object.entries(t))void 0===s&&delete t[e];return{props:t}}let i=n.Image},73672:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},85057:(e,t,s)=>{"use strict";s.d(t,{J:()=>c});var r=s(95155),a=s(12115),n=s(40968),o=s(74466),l=s(59434);let i=(0,o.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.b,{ref:t,className:(0,l.cn)(i(),s),...a})});c.displayName=n.b.displayName},85185:(e,t,s)=>{"use strict";function r(e,t,{checkForDefaultPrevented:s=!0}={}){return function(r){if(e?.(r),!1===s||!r.defaultPrevented)return t?.(r)}}s.d(t,{m:()=>r})},87481:(e,t,s)=>{"use strict";s.d(t,{dj:()=>f});var r=s(12115);let a=0,n=new Map,o=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?o(s):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],c={toasts:[]};function d(e){c=l(c,e),i.forEach(e=>{e(c)})}function u(e){let{...t}=e,s=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>d({type:"DISMISS_TOAST",toastId:s});return d({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||r()}}}),{id:s,dismiss:r,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function f(){let[e,t]=r.useState(c);return r.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},88539:(e,t,s)=>{"use strict";s.d(t,{T:()=>o});var r=s(95155),a=s(12115),n=s(59434);let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...a})});o.displayName="Textarea"},91721:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[5769,6874,1509,3063,9098,5916,8441,1684,7358],()=>t(63993)),_N_E=e.O()}]);