(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2476],{10478:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>j});var l=t(95155),r=t(12115),a=t(35695),n=t(6874),i=t.n(n),o=t(30285),c=t(66695),d=t(30356),u=t(85057),m=t(12543),x=t(45554),h=t(8376),f=t(25711),p=t(87481),g=t(39022);function j(){let{slug:e,weekId:s,testId:t}=(0,a.useParams)(),n=(0,a.useRouter)(),{toast:j}=(0,p.dj)(),[v,N]=(0,r.useState)(null),[y,b]=(0,r.useState)(null),[w,S]=(0,r.useState)(null),[k,C]=(0,r.useState)(null),[R,E]=(0,r.useState)(null),[q,I]=(0,r.useState)(null),[B,_]=(0,r.useState)(!0),[P,T]=(0,r.useState)([]),[Z,A]=(0,r.useState)(0),[L,W]=(0,r.useState)(!1),[F,O]=(0,r.useState)({}),[J,$]=(0,r.useState)(null),[z,M]=(0,r.useState)(null);(0,r.useEffect)(()=>{"string"==typeof e?N(e):N(null)},[e]),(0,r.useEffect)(()=>{"string"==typeof s?b(s):b(null)},[s]),(0,r.useEffect)(()=>{"string"==typeof t?S(t):S(null)},[t]),(0,r.useEffect)(()=>{let e=localStorage.getItem("userProfile");if(e)try{M(JSON.parse(e))}catch(e){console.error("Failed to parse userProfile from localStorage",e),M(g._o)}else M(g._o)},[]),(0,r.useEffect)(()=>{let l=async()=>{if(!v||!y||!w){_(!1);return}_(!0);let e=await (0,f.Z5)(v);if(e){var s,t;C(e);let l=null===(s=e.weeks)||void 0===s?void 0:s.find(e=>e.id===y);if(l){E(l);let e=null===(t=l.learningElements)||void 0===t?void 0:t.find(e=>"psychological_test"===e.type&&e.id===w);e&&"psychological_test"===e.type?I(e.content):(j({title:"Error",description:"Psychological test not found in this week.",variant:"destructive"}),I(null))}else j({title:"Error",description:"Week not found.",variant:"destructive"}),E(null)}else j({title:"Error",description:"Program not found.",variant:"destructive"}),C(null);_(!1)};v&&y&&w?l():(null===e||null===s||null===t)&&_(!1)},[v,y,w,j,e,s,t]);let V=(e,s,t)=>{let l=parseInt(t,10);T(t=>{let r=t.findIndex(e=>e.questionId===s);if(r>-1){let a=[...t];return a[r]={factorId:e,questionId:s,value:l},a}return[...t,{factorId:e,questionId:s,value:l}]})},D=null==q?void 0:q.factors[Z],Y=null==D?void 0:D.questions.every(e=>P.some(s=>s.questionId===e.id)),G=(0,r.useCallback)(()=>{if(!q||!z||0===P.length&&q.factors.reduce((e,s)=>e+s.questions.length,0)>0){W(!0);return}let e={...z,psychTestResponses:{...z.psychTestResponses||{},[q.id]:P}};localStorage.setItem("userProfile",JSON.stringify(e)),M(e),j({title:"Test Responses Saved",description:"Your test results have been recorded."}),W(!0)},[q,z,P,j]),H=(0,r.useCallback)(()=>{if(!q){W(!0);return}let e={},s=0,t=0;q.factors.forEach(l=>{let r=0,a=0;l.questions.forEach(e=>{let s=P.find(s=>s.questionId===e.id);s&&(r+=s.value,a++)}),"average"===l.scoringMethod&&a>0?e[l.id]=r/a:a>0?e[l.id]=r:e[l.id]=0,"average"===q.overallScoringMethod?(s+=r,t+=a):s+=e[l.id]}),O(e),"average"===q.overallScoringMethod&&t>0?$(s/t):"sum"===q.overallScoringMethod&&q.factors.length>0?$(s):$(null),G()},[q,P,G]),K=(e,s)=>s.find(s=>e>=s.scoreRange[0]&&e<=s.scoreRange[1])||{categoryLabel:"N/A",comment:"No specific comment for this score range."};return B||!z?(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,l.jsx)("p",{children:"Loading test..."})}):q&&k&&R?L?(0,l.jsxs)("div",{className:"space-y-6 max-w-3xl mx-auto",children:[(0,l.jsx)(o.$,{variant:"outline",size:"sm",asChild:!0,children:(0,l.jsxs)(i(),{href:v&&y?"/programs/".concat(v,"/week/").concat(y):v?"/programs/".concat(v):"/programs",children:[(0,l.jsx)(m.A,{className:"mr-2 h-4 w-4"})," Back to Week Content"]})}),(0,l.jsxs)(c.Zp,{className:"shadow-xl",children:[(0,l.jsxs)(c.aR,{className:"text-center",children:[(0,l.jsx)(x.A,{className:"h-12 w-12 text-primary mx-auto mb-3"}),(0,l.jsxs)(c.ZB,{className:"text-2xl text-primary",children:["Test Results: ",q.title]})]}),(0,l.jsxs)(c.Wu,{className:"space-y-6",children:[q.factors.map(e=>{let s=F[e.id],t="number"==typeof s?s:0,r=K(t,e.factorResultComments);return(0,l.jsxs)(c.Zp,{className:"bg-muted/30",children:[(0,l.jsxs)(c.aR,{children:[(0,l.jsx)(c.ZB,{className:"text-lg text-accent",children:e.title}),(0,l.jsxs)(c.BT,{children:["Score: ",null==t?void 0:t.toFixed(2)," (",r.categoryLabel,")"]})]}),(0,l.jsx)(c.Wu,{children:(0,l.jsx)("p",{children:r.comment})})]},e.id)}),null!==J&&(0,l.jsxs)(c.Zp,{className:"mt-6 border-primary",children:[(0,l.jsxs)(c.aR,{children:[(0,l.jsx)(c.ZB,{className:"text-xl text-primary",children:"Overall Assessment (총평)"}),(0,l.jsxs)(c.BT,{children:["Overall Score: ",J.toFixed(2)," (",K(J,q.overallResultComments).categoryLabel,")"]})]}),(0,l.jsx)(c.Wu,{children:(0,l.jsx)("p",{className:"font-semibold",children:K(J,q.overallResultComments).comment})})]})]}),(0,l.jsx)(c.wL,{children:(0,l.jsxs)(o.$,{onClick:()=>n.push(v&&y?"/programs/".concat(v,"/week/").concat(y):v?"/programs/".concat(v):"/programs"),className:"w-full",children:[(0,l.jsx)(h.A,{className:"mr-2 h-4 w-4"})," Done"]})})]})]}):D?(0,l.jsxs)("div",{className:"space-y-6 max-w-3xl mx-auto",children:[(0,l.jsx)(o.$,{variant:"outline",size:"sm",asChild:!0,children:(0,l.jsxs)(i(),{href:v&&y?"/programs/".concat(v,"/week/").concat(y):v?"/programs/".concat(v):"/programs",children:[(0,l.jsx)(m.A,{className:"mr-2 h-4 w-4"})," Back to Week Content"]})}),(0,l.jsxs)(c.Zp,{className:"shadow-xl",children:[(0,l.jsxs)(c.aR,{children:[(0,l.jsx)(c.ZB,{className:"text-2xl text-primary",children:q.title}),q.description&&(0,l.jsx)(c.BT,{children:q.description}),(0,l.jsxs)("p",{className:"text-sm text-muted-foreground pt-2",children:["Section ",Z+1," of ",q.factors.length,": ",(0,l.jsx)("span",{className:"font-semibold text-foreground",children:D.title})]})]}),(0,l.jsx)(c.Wu,{className:"space-y-6",children:D.questions.map((e,s)=>{var t;return(0,l.jsxs)("div",{className:"p-4 border rounded-md bg-secondary/10",children:[(0,l.jsxs)(u.J,{htmlFor:"q-".concat(e.id),className:"text-base font-medium text-foreground/90 block mb-3",children:[s+1,". ",e.text]}),(0,l.jsx)(d.z,{id:"q-".concat(e.id),onValueChange:s=>V(D.id,e.id,s),value:null===(t=P.find(s=>s.questionId===e.id))||void 0===t?void 0:t.value.toString(),className:"space-y-2",children:e.options.map(e=>(0,l.jsxs)("div",{className:"flex items-center space-x-2 p-2 rounded hover:bg-primary/10 transition-colors",children:[(0,l.jsx)(d.C,{value:e.value.toString(),id:"opt-".concat(e.id)}),(0,l.jsx)(u.J,{htmlFor:"opt-".concat(e.id),className:"font-normal cursor-pointer flex-1",children:e.text})]},e.id))})]},e.id)})}),(0,l.jsx)(c.wL,{className:"flex justify-end",children:(0,l.jsx)(o.$,{onClick:()=>{D&&Y?Z<((null==q?void 0:q.factors.length)||0)-1?A(e=>e+1):H():j({title:"Incomplete",description:"Please answer all questions in this section.",variant:"destructive"})},disabled:!Y,children:Z<q.factors.length-1?"Next Section":"View Results"})})]})]}):(0,l.jsx)("div",{className:"text-center py-10",children:(0,l.jsx)("p",{children:"Error: No current factor to display for the test."})}):(0,l.jsxs)("div",{className:"text-center py-10",children:[(0,l.jsx)("h1",{className:"text-2xl font-semibold",children:"Test Not Found"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"The psychological test you are looking for does not exist or could not be loaded."}),(0,l.jsx)(o.$,{asChild:!0,variant:"link",className:"mt-4",children:(0,l.jsxs)(i(),{href:v&&y?"/programs/".concat(v,"/week/").concat(y):v?"/programs/".concat(v):"/programs",children:[(0,l.jsx)(m.A,{className:"mr-2 h-4 w-4"})," Back to Program/Week"]})})]})}},30356:(e,s,t)=>{"use strict";t.d(s,{C:()=>c,z:()=>o});var l=t(95155),r=t(12115),a=t(54059),n=t(70154),i=t(59434);let o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,l.jsx)(a.bL,{className:(0,i.cn)("grid gap-2",t),...r,ref:s})});o.displayName=a.bL.displayName;let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,l.jsx)(a.q7,{ref:s,className:(0,i.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:(0,l.jsx)(a.C1,{className:"flex items-center justify-center",children:(0,l.jsx)(n.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});c.displayName=a.q7.displayName},85057:(e,s,t)=>{"use strict";t.d(s,{J:()=>c});var l=t(95155),r=t(12115),a=t(40968),n=t(74466),i=t(59434);let o=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,l.jsx)(a.b,{ref:s,className:(0,i.cn)(o(),t),...r})});c.displayName=a.b.displayName},95480:(e,s,t)=>{Promise.resolve().then(t.bind(t,10478))}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,9855,5769,6874,1509,1174,9098,6174,5916,9127,8441,1684,7358],()=>s(95480)),_N_E=e.O()}]);