"use strict";exports.id=1509,exports.ids=[1509],exports.modules={21509:(t,e,r)=>{let a;r.d(e,{rC:()=>F,GD:()=>G,HD:()=>L,Z5:()=>Y,ub:()=>U,El:()=>K});var i=r(67989),o=r(75535),s=r(45710),c=r(70146),n=r(24890);let l={apiKey:"AIzaSyB-1zPYDO0vrHne8qQIalkd8MxhuBLxVWY",authDomain:"parenting-pathways.firebaseapp.com",projectId:"parenting-pathways",storageBucket:"parenting-pathways.appspot.com",messagingSenderId:"815770438418",appId:"1:815770438418:web:9635282aae4ba32dec41cb",measurementId:process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID},g=Object.values(l).every(t=>null!=t&&""!==t);g||console.warn("WARNING: Using fallback Firebase config in production for testing. Use environment variables in actual production."),a=(0,i.Dk)().length?(0,i.Sx)():(0,i.Wp)(g?l:{apiKey:"AIzaSyB-1zPYDO0vrHne8qQIalkd8MxhuBLxVWY",authDomain:"parenting-pathways.firebaseapp.com",projectId:"parenting-pathways",storageBucket:"parenting-pathways.appspot.com",messagingSenderId:"815770438418",appId:"1:815770438418:web:9635282aae4ba32dec41cb"});let h=(0,o.aU)(a);(0,s.xI)(a),(0,c.c7)(a),(0,n.Uz)(a);var u=r(36464);class p extends Error{constructor(t,e="APP_ERROR",r=500){super(t),this.code=e,this.httpStatus=r,this.name=this.constructor.name,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}toJSON(){return{error:{name:this.name,code:this.code,message:this.message,httpStatus:this.httpStatus}}}}class d extends p{constructor(t,e="DATABASE_ERROR",r=500){super(t,e,r)}}class m extends p{constructor(t,e){super(`${t} with id '${e}' not found`,"DOCUMENT_NOT_FOUND",404)}}class y extends p{constructor(t,e,r="VALIDATION_ERROR"){super(t,r,400),this.field=e}toJSON(){return{error:{...super.toJSON().error,field:this.field}}}}class w extends p{constructor(t,e="NETWORK_ERROR",r=500){super(t,e,r)}}function f(t,e,r=!1){let a=(console.error("Error caught:",t),t instanceof p)?{message:t.message,code:t.code,httpStatus:t.httpStatus}:t instanceof Error?{message:t.message,code:"UNEXPECTED_ERROR",httpStatus:500}:{message:"string"==typeof t?t:"An unexpected error occurred",code:"UNKNOWN_ERROR",httpStatus:500};if(console.error("Application error:",JSON.stringify({timestamp:new Date().toISOString(),...a,...e?{context:e}:{}},null,2)),r)throw t instanceof p?t:new p(a.message,a.code)}var S=function(t){return t.MEMORY_ONLY="memory_only",t.MEMORY_AND_PERSIST="memory_and_persist",t.PERSIST_ONLY="persist_only",t}({});let N={ttl:3e5,strategy:"memory_only",tags:[],priority:0};class E{constructor(t=0xa00000){this.cache=new Map,this.totalSize=0,this.maxSize=t}get(t){let e=this.cache.get(t);return e?e.expires<Date.now()?(this.delete(t),null):(e.accessCount++,e.lastAccessed=Date.now(),e.data):null}set(t,e,r){let a=this.approximateSize(e),i={data:e,expires:Date.now()+r.ttl,accessCount:0,lastAccessed:Date.now(),priority:r.priority,tags:r.tags,size:a};this.cache.has(t)&&(this.totalSize-=this.cache.get(t)?.size||0),this.totalSize+a>this.maxSize&&this.evictItems(a),this.cache.set(t,i),this.totalSize+=a}delete(t){let e=this.cache.get(t);e&&(this.totalSize-=e.size,this.cache.delete(t))}clear(){this.cache.clear(),this.totalSize=0}clearByTag(t){let e=[];this.cache.forEach((r,a)=>{r.tags.includes(t)&&e.push(a)}),e.forEach(t=>this.delete(t))}evictItems(t){let e=Array.from(this.cache.entries()).sort(([,t],[,e])=>t.priority!==e.priority?t.priority-e.priority:t.lastAccessed-e.lastAccessed),r=0,a=[];for(let[i,o]of e)if(a.push(i),(r+=o.size)>=t)break;a.forEach(t=>this.delete(t))}approximateSize(t){if(null==t)return 8;try{let e=JSON.stringify(t);return 2*e.length}catch(t){return 1024}}}class I{constructor(t="cache:"){this.prefix=t}get(t){return null}set(t,e,r){}delete(t){}clear(){}clearByTag(t){}evictOldestItems(){}}let P=new E,O=new I;function R(t){return{get:e=>(function(t){let e=P.get(t);return null!==e?e:O.get(t)})(`${t}:${e}`),set:(e,r,a)=>(function(t,e,r={}){let a={...N,...r};switch(a.strategy){case"memory_only":P.set(t,e,a);break;case"persist_only":O.set(t,e,a);break;case"memory_and_persist":P.set(t,e,a),O.set(t,e,a)}})(`${t}:${e}`,r,a),remove:e=>{var r;return r=`${t}:${e}`,void(P.delete(r),O.delete(r))},clear:()=>{P.clearByTag(t),O.clearByTag(t)}}}let v=R("program"),_=R("programList"),A=R("programPagination"),D=((t=100)=>{let e=[];return async r=>{let a=Date.now();for(;e.length>0&&e[0]<a-6e4;)e.shift();if(e.length>=t)throw Error(`Rate limit exceeded. Max ${t} operations per minute.`);return e.push(a),r()}})(300),b={toFirestore(t){let e=t.title,r=t.slug;if(!e?.trim())throw new y("Program title is required");if(!r?.trim())throw new y("Program slug is required");let a={...t};return a.updatedAt=(0,o.O5)(),a.createdAt||(a.createdAt=(0,o.O5)()),a.weeks&&Array.isArray(a.weeks)&&(a.weeks=a.weeks.map(t=>({...t,weekNumber:"number"==typeof t.weekNumber?t.weekNumber:parseInt(String(t.weekNumber),10)}))),a.companySpecificDocuments&&Array.isArray(a.companySpecificDocuments)&&a.companySpecificDocuments.length>0&&(a.companySpecificDocuments=a.companySpecificDocuments.map(t=>({...t}))),a},fromFirestore(t,e){let{createdAt:r,updatedAt:a,...i}=t.data(e);return{id:t.id,...i,createdAt:r?new Date(1e3*r.seconds).toISOString():void 0,updatedAt:a?new Date(1e3*a.seconds).toISOString():void 0}}};function T(t,e,r){if(t instanceof o.W6)switch(t.code){case"not-found":throw new m("Document",String(r?.id||"unknown"));case"permission-denied":throw new d(`Permission denied during ${e}`,"PERMISSION_DENIED");case"unavailable":throw new w(`Network error during ${e}: ${t.message}`);case"aborted":throw new d(`Transaction aborted during ${e}`,"TRANSACTION_ERROR");default:throw new d(`Firestore error during ${e}: ${t.message}`,`UNKNOWN_ERROR_${t.code}`)}if(t instanceof y)throw t;if(t instanceof Error)throw new d(`Error during ${e}: ${t.message}`,"UNKNOWN_ERROR");throw new d(`Unknown error during ${e}`,"UNKNOWN_ERROR")}class ${constructor(t="programs",e={}){this.collectionName=t,this.collection=(0,o.rJ)(h,t).withConverter(b),this.useFallbackInDev=e.useFallbackInDev??!0}getItemCacheKey(t){return t}getSlugCacheKey(t){return`slug:${t}`}getPaginationCacheKey(t,e){return`page:${t}:${e||"first"}`}async getAll(){try{let t=_.get("all");if(t)return t;return await D(async()=>{let t=(await (0,o.GG)(this.collection)).docs.map(t=>t.data());return _.set("all",t,{ttl:3e5,strategy:S.MEMORY_AND_PERSIST,tags:["programs"]}),t})}catch(t){f(t,{operation:"getAll",collection:this.collectionName}),T(t,"getting all programs",{collection:this.collectionName})}}async getById(t){if(!t)return null;try{let e=this.getItemCacheKey(t),r=v.get(e);if(r)return r;return await D(async()=>{let r=(0,o.H9)(this.collection,t),a=await (0,o.x7)(r);if(a.exists()){let r=a.data();return v.set(e,r,{ttl:3e5,strategy:S.MEMORY_AND_PERSIST,tags:["programs",`program:${t}`]}),r}return null})}catch(e){f(e,{operation:"getById",id:t,collection:this.collectionName}),T(e,"getting program by ID",{id:t,collection:this.collectionName})}}async getBySlug(t){if(!t)return null;try{let e=this.getSlugCacheKey(t),r=v.get(e);if(r)return r;return await D(async()=>{let r=(0,o.P)(this.collection,(0,o._M)("slug","==",t)),a=await (0,o.GG)(r);if(!a.empty){let t=a.docs[0].data();return v.set(e,t,{ttl:3e5,strategy:S.MEMORY_AND_PERSIST,tags:["programs",`program:${t.id}`]}),v.set(this.getItemCacheKey(t.id),t,{ttl:3e5,strategy:S.MEMORY_AND_PERSIST,tags:["programs",`program:${t.id}`]}),t}return null})}catch(e){f(e,{operation:"getBySlug",slug:t,collection:this.collectionName}),T(e,"getting program by slug",{slug:t,collection:this.collectionName})}}async create(t){try{return await D(async()=>await (0,o.c4)(h,async e=>{let r=(0,o.P)(this.collection,(0,o._M)("slug","==",t.slug));if(!(await (0,o.GG)(r)).empty)throw new y(`Program with slug '${t.slug}' already exists`);let a=await (0,o.gS)(this.collection,t);return this.invalidateCache(),a.id}))}catch(e){f(e,{operation:"create",programTitle:t.title,collection:this.collectionName}),T(e,"creating program",{programTitle:t.title,collection:this.collectionName})}}async update(t,e){try{return await D(async()=>await (0,o.c4)(h,async r=>{let a=(0,o.H9)(this.collection,t),i=await r.get(a);if(!i.exists())throw new m("Program",t);if(e.slug){let r=i.data();if(e.slug!==r.slug){let r=(0,o.P)(this.collection,(0,o._M)("slug","==",e.slug)),a=await (0,o.GG)(r);if(!a.empty&&a.docs[0].id!==t)throw new y(`Program with slug '${e.slug}' already exists`)}}return r.update(a,{...e,updatedAt:(0,o.O5)()}),this.invalidateCache(t),!0}))}catch(e){f(e,{operation:"update",id:t,collection:this.collectionName}),T(e,"updating program",{id:t,collection:this.collectionName})}}async delete(t){try{return await D(async()=>{let e=(0,o.H9)(this.collection,t);return await (0,o.kd)(e),this.invalidateCache(t),!0})}catch(e){f(e,{operation:"delete",id:t,collection:this.collectionName}),T(e,"deleting program",{id:t,collection:this.collectionName})}}async getPaginated(t=10,e){try{let r=this.getPaginationCacheKey(t,e),a=A.get(r);if(a)return a;return await D(async()=>{let a=(0,o.P)(this.collection,(0,o.My)("title"),(0,o.AB)(t+1));if(e){let t=(0,o.H9)(this.collection,e),r=await (0,o.x7)(t);r.exists()&&(a=(0,o.P)(a,(0,o.HM)(r)))}let i=await (0,o.GG)(a),s=i.docs.length>t,c=i.docs.slice(0,t).map(t=>t.data()),n=i.docs[t-1],l={programs:c,lastId:n?.id,hasMore:s};return A.set(r,l,{ttl:3e5,strategy:S.MEMORY_ONLY,tags:["programs","pagination"]}),l})}catch(r){f(r,{operation:"getPaginated",pageSize:t,lastId:e,collection:this.collectionName}),T(r,"fetching paginated programs",{pageSize:t,lastId:e,collection:this.collectionName})}}async getFieldsOnly(t,e=20){try{return(await this.getAll()).slice(0,e).map(e=>{let r={id:e.id};return t.forEach(t=>{t in e&&(r[t]=e[t])}),r})}catch(r){f(r,{operation:"getFieldsOnly",fields:t,maxResults:e,collection:this.collectionName}),T(r,"fetching fields-only programs",{fields:t,maxResults:e,collection:this.collectionName})}}async batchCreateOrUpdate(t){try{if(t.length>500)throw new y("Batch size exceeds Firebase maximum of 500 operations");return await D(async()=>{let e=(0,o.wP)(h),r=new Map;for(let a=0;a<t.length;a++){let i;let s=t[a];"id"in s&&s.id?(i=(0,o.H9)(this.collection,s.id),e.update(i,{...s,updatedAt:(0,o.O5)()}),r.set(a,s.id)):(i=(0,o.H9)(this.collection),e.set(i,{...s,createdAt:(0,o.O5)(),updatedAt:(0,o.O5)()}),r.set(a,i.id))}return await e.commit(),this.invalidateCache(),r})}catch(e){f(e,{operation:"batchCreateOrUpdate",count:t.length,collection:this.collectionName}),T(e,"batch creating/updating programs",{count:t.length,collection:this.collectionName})}}async getProgramIdsByTag(t){try{return await D(async()=>{let e=(0,o.P)(this.collection,(0,o._M)("tags","array-contains",t));return(await (0,o.GG)(e)).docs.map(t=>t.id)})}catch(e){f(e,{operation:"getProgramIdsByTag",tag:t,collection:this.collectionName}),T(e,"getting program IDs by tag",{tag:t,collection:this.collectionName})}}async count(){try{return await D(async()=>(await (0,o.d_)(this.collection)).data().count)}catch(t){f(t,{operation:"count",collection:this.collectionName}),T(t,"counting programs",{collection:this.collectionName})}}invalidateCache(t){t?v.remove(this.getItemCacheKey(t)):(_.clear(),A.clear())}getFallbackPrograms(){return u.SR}}let x=["title","description","imageUrl","slug","targetAudience","tags"];R("program");let M=R("programList"),C=R("programPagination"),B=R("lightweightPrograms");class k{constructor(t,e){this.repository=t||function(t={}){return new $("programs",t)}({useFallbackInDev:e?.useFallbackInDev??!0}),this.cacheStrategy=e?.cacheStrategy??S.MEMORY_ONLY,this.cacheTTL=e?.cacheTTL??3e5}async getPrograms(){try{let t=M.get("all");if(t)return t;let e=await this.repository.getAll();return M.set("all",e,{ttl:this.cacheTTL,strategy:this.cacheStrategy,tags:["programs"]}),e}catch(t){return console.error("Error fetching all programs:",t),[]}}async getProgramById(t){if(!t)return console.error("Invalid program ID provided"),null;try{return await this.repository.getById(t)}catch(e){return console.error(`Error fetching program by ID ${t}:`,e),null}}async getProgramBySlug(t){if(!t)return console.error("Invalid program slug provided"),null;try{return await this.repository.getBySlug(t)}catch(e){return console.error(`Error fetching program by slug ${t}:`,e),null}}async createProgram(t){try{if(!t.title?.trim()||!t.slug?.trim())throw Error("Program title and slug are required");let e=await this.repository.create(t);return e&&this.invalidateCache(),e}catch(t){return console.error("Error creating program:",t),null}}async batchCreateOrUpdatePrograms(t){try{if(!t.length)return new Map;t.forEach((t,e)=>{if(!t.title?.trim()||!t.slug?.trim())throw Error(`Program at index ${e} is missing title or slug`)});let e=await this.repository.batchCreateOrUpdate(t);return this.invalidateCache(),e}catch(t){return console.error("Error batch creating/updating programs:",t),new Map}}async updateProgram(t,e){if(!t)return console.error("Invalid program ID provided for update"),!1;try{let r=await this.repository.update(t,e);return r&&this.invalidateCache(t),r}catch(e){return console.error(`Error updating program ${t}:`,e),!1}}async deleteProgram(t){if(!t)return console.error("Invalid program ID provided for deletion"),!1;try{let e=await this.repository.delete(t);return e&&this.invalidateCache(),e}catch(e){return console.error(`Error deleting program ${t}:`,e),!1}}async getPaginatedPrograms(t=10,e){try{let r=`${t}:${e||"first"}`,a=C.get(r);if(a)return a;let i=await this.repository.getPaginated(t,e);return C.set(r,i,{ttl:this.cacheTTL,strategy:this.cacheStrategy,tags:["programs","pagination"]}),i}catch(t){return console.error("Error fetching paginated programs:",t),{programs:[],hasMore:!1}}}async getLightweightPrograms(t=20){try{let e=`top:${t}`,r=B.get(e);if(r)return r;let a=await this.repository.getFieldsOnly(x,t);return B.set(e,a,{ttl:this.cacheTTL,strategy:this.cacheStrategy,tags:["programs","lightweight"]}),a}catch(t){return console.error("Error fetching lightweight programs:",t),[]}}async getProgramsByTag(t){if(!t)return console.error("Invalid tag provided"),[];try{let e=`tag:${t}`,r=M.get(e);if(r)return r;let a=await this.repository.getProgramIdsByTag(t);if(!a.length)return[];let i=a.map(t=>this.getProgramById(t)),o=(await Promise.all(i)).filter(Boolean);return M.set(e,o,{ttl:this.cacheTTL,strategy:this.cacheStrategy,tags:["programs",`tag:${t}`]}),o}catch(e){return console.error(`Error fetching programs by tag ${t}:`,e),[]}}async countPrograms(){try{return await this.repository.count()}catch(t){return console.error("Error counting programs:",t),0}}invalidateCache(t){t?this.repository.invalidateCache(t):(this.repository.invalidateCache(),M.clear(),C.clear(),B.clear())}}let z=new k,U=()=>z.getPrograms(),L=t=>z.getProgramById(t),Y=t=>z.getProgramBySlug(t),F=t=>z.createProgram(t),K=(t,e)=>z.updateProgram(t,e),G=t=>z.deleteProgram(t)}};