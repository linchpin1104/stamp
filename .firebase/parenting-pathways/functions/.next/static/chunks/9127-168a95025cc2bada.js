"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9127],{25711:(t,e,r)=>{let a;r.d(e,{rC:()=>G,GD:()=>W,HD:()=>L,Z5:()=>Y,ub:()=>F,El:()=>K});var o=r(23915),i=r(35317),c=r(93004),n=r(90858),s=r(81427);let l={apiKey:"AIzaSyB-1zPYDO0vrHne8qQIalkd8MxhuBLxVWY",authDomain:"parenting-pathways.firebaseapp.com",projectId:"parenting-pathways",storageBucket:"parenting-pathways.appspot.com",messagingSenderId:"815770438418",appId:"1:815770438418:web:9635282aae4ba32dec41cb",measurementId:r(49509).env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID},g=Object.values(l).every(t=>null!=t&&""!==t);g||console.warn("WARNING: Using fallback Firebase config in production for testing. Use environment variables in actual production."),a=(0,o.Dk)().length?(0,o.Sx)():(0,o.Wp)(g?l:{apiKey:"AIzaSyB-1zPYDO0vrHne8qQIalkd8MxhuBLxVWY",authDomain:"parenting-pathways.firebaseapp.com",projectId:"parenting-pathways",storageBucket:"parenting-pathways.appspot.com",messagingSenderId:"815770438418",appId:"1:815770438418:web:9635282aae4ba32dec41cb"});let h=(0,i.aU)(a);(0,c.xI)(a),(0,n.c7)(a),(0,s.Uz)(a),(0,i.ol)(h).catch(t=>{"failed-precondition"===t.code?console.warn("Firestore persistence could not be enabled. Multiple tabs open."):"unimplemented"===t.code&&console.warn("Firestore persistence is not available in this browser")});var u=r(39022);class d extends Error{toJSON(){return{error:{name:this.name,code:this.code,message:this.message,httpStatus:this.httpStatus}}}constructor(t,e="APP_ERROR",r=500){super(t),this.code=e,this.httpStatus=r,this.name=this.constructor.name,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class p extends d{constructor(t,e="DATABASE_ERROR",r=500){super(t,e,r)}}class m extends d{constructor(t,e){super("".concat(t," with id '").concat(e,"' not found"),"DOCUMENT_NOT_FOUND",404)}}class y extends d{toJSON(){return{error:{...super.toJSON().error,field:this.field}}}constructor(t,e,r="VALIDATION_ERROR"){super(t,r,400),this.field=e}}class f extends d{constructor(t,e="NETWORK_ERROR",r=500){super(t,e,r)}}function w(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=(console.error("Error caught:",t),t instanceof d)?{message:t.message,code:t.code,httpStatus:t.httpStatus}:t instanceof Error?{message:t.message,code:"UNEXPECTED_ERROR",httpStatus:500}:{message:"string"==typeof t?t:"An unexpected error occurred",code:"UNKNOWN_ERROR",httpStatus:500};if(console.error("Application error:",JSON.stringify({timestamp:new Date().toISOString(),...a,...e?{context:e}:{}},null,2)),r)throw t instanceof d?t:new d(a.message,a.code)}var S=function(t){return t.MEMORY_ONLY="memory_only",t.MEMORY_AND_PERSIST="memory_and_persist",t.PERSIST_ONLY="persist_only",t}({});let v={ttl:3e5,strategy:"memory_only",tags:[],priority:0};class E{get(t){let e=this.cache.get(t);return e?e.expires<Date.now()?(this.delete(t),null):(e.accessCount++,e.lastAccessed=Date.now(),e.data):null}set(t,e,r){let a=this.approximateSize(e),o={data:e,expires:Date.now()+r.ttl,accessCount:0,lastAccessed:Date.now(),priority:r.priority,tags:r.tags,size:a};if(this.cache.has(t)){var i;this.totalSize-=(null===(i=this.cache.get(t))||void 0===i?void 0:i.size)||0}this.totalSize+a>this.maxSize&&this.evictItems(a),this.cache.set(t,o),this.totalSize+=a}delete(t){let e=this.cache.get(t);e&&(this.totalSize-=e.size,this.cache.delete(t))}clear(){this.cache.clear(),this.totalSize=0}clearByTag(t){let e=[];this.cache.forEach((r,a)=>{r.tags.includes(t)&&e.push(a)}),e.forEach(t=>this.delete(t))}evictItems(t){let e=Array.from(this.cache.entries()).sort((t,e)=>{let[,r]=t,[,a]=e;return r.priority!==a.priority?r.priority-a.priority:r.lastAccessed-a.lastAccessed}),r=0,a=[];for(let[o,i]of e)if(a.push(o),(r+=i.size)>=t)break;a.forEach(t=>this.delete(t))}approximateSize(t){if(null==t)return 8;try{let e=JSON.stringify(t);return 2*e.length}catch(t){return 1024}}constructor(t=0xa00000){this.cache=new Map,this.totalSize=0,this.maxSize=t}}class I{get(t){try{let e=localStorage.getItem(this.prefix+t);if(!e)return null;let r=JSON.parse(e);if(r.expires<Date.now())return this.delete(t),null;return r.data}catch(e){return console.warn("Error reading cache for key ".concat(t,":"),e),null}}set(t,e,r){try{let a={data:e,expires:Date.now()+r.ttl,accessCount:0,lastAccessed:Date.now(),priority:r.priority,tags:r.tags,size:0};localStorage.setItem(this.prefix+t,JSON.stringify(a))}catch(a){if(a instanceof DOMException&&"QuotaExceededError"===a.name){this.evictOldestItems();try{this.set(t,e,r)}catch(t){console.warn("Failed to write to localStorage cache after eviction: ".concat(t))}}else console.warn("Error writing to localStorage cache for key ".concat(t,":"),a)}}delete(t){localStorage.removeItem(this.prefix+t)}clear(){let t=[];for(let e=0;e<localStorage.length;e++){let r=localStorage.key(e);r&&r.startsWith(this.prefix)&&t.push(r)}t.forEach(t=>localStorage.removeItem(t))}clearByTag(t){let e=[];for(let r=0;r<localStorage.length;r++){let a=localStorage.key(r);if(a&&a.startsWith(this.prefix))try{let r=JSON.parse(localStorage.getItem(a)||"{}");r.tags&&r.tags.includes(t)&&e.push(a)}catch(t){}}e.forEach(t=>localStorage.removeItem(t))}evictOldestItems(){let t=[];for(let e=0;e<localStorage.length;e++){let r=localStorage.key(e);if(r&&r.startsWith(this.prefix))try{let e=JSON.parse(localStorage.getItem(r)||"{}");t.push([r,e])}catch(t){}}t.sort((t,e)=>{let[,r]=t,[,a]=e;return r.expires-a.expires});let e=Math.max(1,Math.floor(.2*t.length));t.slice(0,e).forEach(t=>{let[e]=t;return localStorage.removeItem(e)})}constructor(t="cache:"){this.prefix=t}}let O=new E,N=new I;function T(t){return{get:e=>(function(t){let e=O.get(t);return null!==e?e:N.get(t)})("".concat(t,":").concat(e)),set:(e,r,a)=>(function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={...v,...r};switch(a.strategy){case"memory_only":O.set(t,e,a);break;case"persist_only":N.set(t,e,a);break;case"memory_and_persist":O.set(t,e,a),N.set(t,e,a)}})("".concat(t,":").concat(e),r,a),remove:e=>{var r;return r="".concat(t,":").concat(e),void(O.delete(r),N.delete(r))},clear:()=>{O.clearByTag(t),N.clearByTag(t)}}}let P=T("program"),_=T("programList"),A=T("programPagination"),D=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,e=[];return async r=>{let a=Date.now();for(;e.length>0&&e[0]<a-6e4;)e.shift();if(e.length>=t)throw Error("Rate limit exceeded. Max ".concat(t," operations per minute."));return e.push(a),r()}}(300),R={toFirestore(t){let e=t.title,r=t.slug;if(!(null==e?void 0:e.trim()))throw new y("Program title is required");if(!(null==r?void 0:r.trim()))throw new y("Program slug is required");let a={...t};return a.updatedAt=(0,i.O5)(),a.createdAt||(a.createdAt=(0,i.O5)()),a.weeks&&Array.isArray(a.weeks)&&(a.weeks=a.weeks.map(t=>({...t,weekNumber:"number"==typeof t.weekNumber?t.weekNumber:parseInt(String(t.weekNumber),10)}))),a.companySpecificDocuments&&Array.isArray(a.companySpecificDocuments)&&a.companySpecificDocuments.length>0&&(a.companySpecificDocuments=a.companySpecificDocuments.map(t=>({...t}))),a},fromFirestore(t,e){let{createdAt:r,updatedAt:a,...o}=t.data(e);return{id:t.id,...o,createdAt:r?new Date(1e3*r.seconds).toISOString():void 0,updatedAt:a?new Date(1e3*a.seconds).toISOString():void 0}}};function b(t,e,r){if(t instanceof i.W6)switch(t.code){case"not-found":throw new m("Document",String((null==r?void 0:r.id)||"unknown"));case"permission-denied":throw new p("Permission denied during ".concat(e),"PERMISSION_DENIED");case"unavailable":throw new f("Network error during ".concat(e,": ").concat(t.message));case"aborted":throw new p("Transaction aborted during ".concat(e),"TRANSACTION_ERROR");default:throw new p("Firestore error during ".concat(e,": ").concat(t.message),"UNKNOWN_ERROR_".concat(t.code))}if(t instanceof y)throw t;if(t instanceof Error)throw new p("Error during ".concat(e,": ").concat(t.message),"UNKNOWN_ERROR");throw new p("Unknown error during ".concat(e),"UNKNOWN_ERROR")}class x{getItemCacheKey(t){return t}getSlugCacheKey(t){return"slug:".concat(t)}getPaginationCacheKey(t,e){return"page:".concat(t,":").concat(e||"first")}async getAll(){try{let t=_.get("all");if(t)return t;return await D(async()=>{let t=(await (0,i.GG)(this.collection)).docs.map(t=>t.data());return _.set("all",t,{ttl:3e5,strategy:S.MEMORY_AND_PERSIST,tags:["programs"]}),t})}catch(t){w(t,{operation:"getAll",collection:this.collectionName}),b(t,"getting all programs",{collection:this.collectionName})}}async getById(t){if(!t)return null;try{let e=this.getItemCacheKey(t),r=P.get(e);if(r)return r;return await D(async()=>{let r=(0,i.H9)(this.collection,t),a=await (0,i.x7)(r);if(a.exists()){let r=a.data();return P.set(e,r,{ttl:3e5,strategy:S.MEMORY_AND_PERSIST,tags:["programs","program:".concat(t)]}),r}return null})}catch(e){w(e,{operation:"getById",id:t,collection:this.collectionName}),b(e,"getting program by ID",{id:t,collection:this.collectionName})}}async getBySlug(t){if(!t)return null;try{let e=this.getSlugCacheKey(t),r=P.get(e);if(r)return r;return await D(async()=>{let r=(0,i.P)(this.collection,(0,i._M)("slug","==",t)),a=await (0,i.GG)(r);if(!a.empty){let t=a.docs[0].data();return P.set(e,t,{ttl:3e5,strategy:S.MEMORY_AND_PERSIST,tags:["programs","program:".concat(t.id)]}),P.set(this.getItemCacheKey(t.id),t,{ttl:3e5,strategy:S.MEMORY_AND_PERSIST,tags:["programs","program:".concat(t.id)]}),t}return null})}catch(e){w(e,{operation:"getBySlug",slug:t,collection:this.collectionName}),b(e,"getting program by slug",{slug:t,collection:this.collectionName})}}async create(t){try{return await D(async()=>await (0,i.c4)(h,async e=>{let r=(0,i.P)(this.collection,(0,i._M)("slug","==",t.slug));if(!(await (0,i.GG)(r)).empty)throw new y("Program with slug '".concat(t.slug,"' already exists"));let a=await (0,i.gS)(this.collection,t);return this.invalidateCache(),a.id}))}catch(e){w(e,{operation:"create",programTitle:t.title,collection:this.collectionName}),b(e,"creating program",{programTitle:t.title,collection:this.collectionName})}}async update(t,e){try{return await D(async()=>await (0,i.c4)(h,async r=>{let a=(0,i.H9)(this.collection,t),o=await r.get(a);if(!o.exists())throw new m("Program",t);if(e.slug){let r=o.data();if(e.slug!==r.slug){let r=(0,i.P)(this.collection,(0,i._M)("slug","==",e.slug)),a=await (0,i.GG)(r);if(!a.empty&&a.docs[0].id!==t)throw new y("Program with slug '".concat(e.slug,"' already exists"))}}return r.update(a,{...e,updatedAt:(0,i.O5)()}),this.invalidateCache(t),!0}))}catch(e){w(e,{operation:"update",id:t,collection:this.collectionName}),b(e,"updating program",{id:t,collection:this.collectionName})}}async delete(t){try{return await D(async()=>{let e=(0,i.H9)(this.collection,t);return await (0,i.kd)(e),this.invalidateCache(t),!0})}catch(e){w(e,{operation:"delete",id:t,collection:this.collectionName}),b(e,"deleting program",{id:t,collection:this.collectionName})}}async getPaginated(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;try{let r=this.getPaginationCacheKey(t,e),a=A.get(r);if(a)return a;return await D(async()=>{let a=(0,i.P)(this.collection,(0,i.My)("title"),(0,i.AB)(t+1));if(e){let t=(0,i.H9)(this.collection,e),r=await (0,i.x7)(t);r.exists()&&(a=(0,i.P)(a,(0,i.HM)(r)))}let o=await (0,i.GG)(a),c=o.docs.length>t,n=o.docs.slice(0,t).map(t=>t.data()),s=o.docs[t-1],l={programs:n,lastId:null==s?void 0:s.id,hasMore:c};return A.set(r,l,{ttl:3e5,strategy:S.MEMORY_ONLY,tags:["programs","pagination"]}),l})}catch(r){w(r,{operation:"getPaginated",pageSize:t,lastId:e,collection:this.collectionName}),b(r,"fetching paginated programs",{pageSize:t,lastId:e,collection:this.collectionName})}}async getFieldsOnly(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;try{return(await this.getAll()).slice(0,e).map(e=>{let r={id:e.id};return t.forEach(t=>{t in e&&(r[t]=e[t])}),r})}catch(r){w(r,{operation:"getFieldsOnly",fields:t,maxResults:e,collection:this.collectionName}),b(r,"fetching fields-only programs",{fields:t,maxResults:e,collection:this.collectionName})}}async batchCreateOrUpdate(t){try{if(t.length>500)throw new y("Batch size exceeds Firebase maximum of 500 operations");return await D(async()=>{let e=(0,i.wP)(h),r=new Map;for(let a=0;a<t.length;a++){let o;let c=t[a];"id"in c&&c.id?(o=(0,i.H9)(this.collection,c.id),e.update(o,{...c,updatedAt:(0,i.O5)()}),r.set(a,c.id)):(o=(0,i.H9)(this.collection),e.set(o,{...c,createdAt:(0,i.O5)(),updatedAt:(0,i.O5)()}),r.set(a,o.id))}return await e.commit(),this.invalidateCache(),r})}catch(e){w(e,{operation:"batchCreateOrUpdate",count:t.length,collection:this.collectionName}),b(e,"batch creating/updating programs",{count:t.length,collection:this.collectionName})}}async getProgramIdsByTag(t){try{return await D(async()=>{let e=(0,i.P)(this.collection,(0,i._M)("tags","array-contains",t));return(await (0,i.GG)(e)).docs.map(t=>t.id)})}catch(e){w(e,{operation:"getProgramIdsByTag",tag:t,collection:this.collectionName}),b(e,"getting program IDs by tag",{tag:t,collection:this.collectionName})}}async count(){try{return await D(async()=>(await (0,i.d_)(this.collection)).data().count)}catch(t){w(t,{operation:"count",collection:this.collectionName}),b(t,"counting programs",{collection:this.collectionName})}}invalidateCache(t){t?P.remove(this.getItemCacheKey(t)):(_.clear(),A.clear())}getFallbackPrograms(){return u.SR}constructor(t="programs",e={}){var r;this.collectionName=t,this.collection=(0,i.rJ)(h,t).withConverter(R),this.useFallbackInDev=null===(r=e.useFallbackInDev)||void 0===r||r}}let M=["title","description","imageUrl","slug","targetAudience","tags"];T("program");let k=T("programList"),C=T("programPagination"),B=T("lightweightPrograms");class z{async getPrograms(){try{let t=k.get("all");if(t)return t;let e=await this.repository.getAll();return k.set("all",e,{ttl:this.cacheTTL,strategy:this.cacheStrategy,tags:["programs"]}),e}catch(t){return console.error("Error fetching all programs:",t),[]}}async getProgramById(t){if(!t)return console.error("Invalid program ID provided"),null;try{return await this.repository.getById(t)}catch(e){return console.error("Error fetching program by ID ".concat(t,":"),e),null}}async getProgramBySlug(t){if(!t)return console.error("Invalid program slug provided"),null;try{return await this.repository.getBySlug(t)}catch(e){return console.error("Error fetching program by slug ".concat(t,":"),e),null}}async createProgram(t){try{var e,r;if(!(null===(e=t.title)||void 0===e?void 0:e.trim())||!(null===(r=t.slug)||void 0===r?void 0:r.trim()))throw Error("Program title and slug are required");let a=await this.repository.create(t);return a&&this.invalidateCache(),a}catch(t){return console.error("Error creating program:",t),null}}async batchCreateOrUpdatePrograms(t){try{if(!t.length)return new Map;t.forEach((t,e)=>{var r,a;if(!(null===(r=t.title)||void 0===r?void 0:r.trim())||!(null===(a=t.slug)||void 0===a?void 0:a.trim()))throw Error("Program at index ".concat(e," is missing title or slug"))});let e=await this.repository.batchCreateOrUpdate(t);return this.invalidateCache(),e}catch(t){return console.error("Error batch creating/updating programs:",t),new Map}}async updateProgram(t,e){if(!t)return console.error("Invalid program ID provided for update"),!1;try{let r=await this.repository.update(t,e);return r&&this.invalidateCache(t),r}catch(e){return console.error("Error updating program ".concat(t,":"),e),!1}}async deleteProgram(t){if(!t)return console.error("Invalid program ID provided for deletion"),!1;try{let e=await this.repository.delete(t);return e&&this.invalidateCache(),e}catch(e){return console.error("Error deleting program ".concat(t,":"),e),!1}}async getPaginatedPrograms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1?arguments[1]:void 0;try{let r="".concat(t,":").concat(e||"first"),a=C.get(r);if(a)return a;let o=await this.repository.getPaginated(t,e);return C.set(r,o,{ttl:this.cacheTTL,strategy:this.cacheStrategy,tags:["programs","pagination"]}),o}catch(t){return console.error("Error fetching paginated programs:",t),{programs:[],hasMore:!1}}}async getLightweightPrograms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;try{let e="top:".concat(t),r=B.get(e);if(r)return r;let a=await this.repository.getFieldsOnly(M,t);return B.set(e,a,{ttl:this.cacheTTL,strategy:this.cacheStrategy,tags:["programs","lightweight"]}),a}catch(t){return console.error("Error fetching lightweight programs:",t),[]}}async getProgramsByTag(t){if(!t)return console.error("Invalid tag provided"),[];try{let e="tag:".concat(t),r=k.get(e);if(r)return r;let a=await this.repository.getProgramIdsByTag(t);if(!a.length)return[];let o=a.map(t=>this.getProgramById(t)),i=(await Promise.all(o)).filter(Boolean);return k.set(e,i,{ttl:this.cacheTTL,strategy:this.cacheStrategy,tags:["programs","tag:".concat(t)]}),i}catch(e){return console.error("Error fetching programs by tag ".concat(t,":"),e),[]}}async countPrograms(){try{return await this.repository.count()}catch(t){return console.error("Error counting programs:",t),0}}invalidateCache(t){t?this.repository.invalidateCache(t):(this.repository.invalidateCache(),k.clear(),C.clear(),B.clear())}constructor(t,e){var r,a,o;this.repository=t||function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new x("programs",t)}({useFallbackInDev:null===(r=null==e?void 0:e.useFallbackInDev)||void 0===r||r}),this.cacheStrategy=null!==(a=null==e?void 0:e.cacheStrategy)&&void 0!==a?a:S.MEMORY_ONLY,this.cacheTTL=null!==(o=null==e?void 0:e.cacheTTL)&&void 0!==o?o:3e5}}let U=new z,F=()=>U.getPrograms(),L=t=>U.getProgramById(t),Y=t=>U.getProgramBySlug(t),G=t=>U.createProgram(t),K=(t,e)=>U.updateProgram(t,e),W=t=>U.deleteProgram(t)},87481:(t,e,r)=>{r.d(e,{dj:()=>u});var a=r(12115);let o=0,i=new Map,c=t=>{if(i.has(t))return;let e=setTimeout(()=>{i.delete(t),g({type:"REMOVE_TOAST",toastId:t})},1e6);i.set(t,e)},n=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,1)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{let{toastId:r}=e;return r?c(r):t.toasts.forEach(t=>{c(t.id)}),{...t,toasts:t.toasts.map(t=>t.id===r||void 0===r?{...t,open:!1}:t)}}case"REMOVE_TOAST":if(void 0===e.toastId)return{...t,toasts:[]};return{...t,toasts:t.toasts.filter(t=>t.id!==e.toastId)}}},s=[],l={toasts:[]};function g(t){l=n(l,t),s.forEach(t=>{t(l)})}function h(t){let{...e}=t,r=(o=(o+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>g({type:"DISMISS_TOAST",toastId:r});return g({type:"ADD_TOAST",toast:{...e,id:r,open:!0,onOpenChange:t=>{t||a()}}}),{id:r,dismiss:a,update:t=>g({type:"UPDATE_TOAST",toast:{...t,id:r}})}}function u(){let[t,e]=a.useState(l);return a.useEffect(()=>(s.push(e),()=>{let t=s.indexOf(e);t>-1&&s.splice(t,1)}),[t]),{...t,toast:h,dismiss:t=>g({type:"DISMISS_TOAST",toastId:t})}}}}]);